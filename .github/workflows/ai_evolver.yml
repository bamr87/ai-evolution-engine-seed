name: ğŸŒ± AI Evolution Growth Engine (v0.2.0)

on:
  workflow_dispatch:
    inputs:
      prompt:
        description: 'Growth instructions for the AI (e.g., "Implement user authentication")'
        required: true
        type: string
      growth_mode:
        description: 'Growth strategy (conservative, adaptive, experimental)'
        required: false
        default: 'adaptive'
        type: choice
        options:
          - conservative
          - adaptive
          - experimental
      auto_plant_seeds: # This now refers to auto-committing the new .seed.md
        description: 'Automatically commit the newly generated .seed.md for next evolution?'
        required: false
        default: true
        type: boolean

permissions:
  contents: write
  pull-requests: write
  issues: write # If AI needs to create issues for complex tasks

jobs:
  evolve:
    name: ğŸŒ¿ Growth Cycle v0.2.0
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸŒ± Prepare Growth Environment
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # Need full history for some context, potentially
          
      - name: ğŸ› ï¸ Setup Environment
        run: ./scripts/setup-environment.sh
          
      - name: ğŸ§¬ Collect Repository DNA & Metrics
        id: collect_context
        run: |
          ./scripts/collect-context.sh \
            "${{ inputs.prompt }}" \
            "${{ inputs.growth_mode }}" \
            "/tmp/repo_context.json"
          
      - name: ğŸ§  Invoke Simulated AI Growth Engine
        id: ai_growth_simulation
        run: |
          ./scripts/simulate-ai-growth.sh \
            "${{ inputs.prompt }}" \
            "${{ inputs.growth_mode }}" \
            "/tmp/repo_context.json" \
            "/tmp/evolution_response.json"

      - name: ğŸŒ¾ Apply Growth Changes
        run: ./scripts/apply-growth-changes.sh "/tmp/evolution_response.json"
          
      - name: ğŸŒ° Plant New Seeds (Generate .seed.md for next evolution)
        if: ${{ inputs.auto_plant_seeds == true }}
        run: ./scripts/plant-new-seeds.sh "/tmp/evolution_response.json" "${{ inputs.auto_plant_seeds }}"
          
      - name: ğŸŒ³ Create Growth Pull Request
        env:
          GH_TOKEN: ${{ github.token }}
        run: ./scripts/create_pr.sh "/tmp/evolution_response.json" "${{ inputs.prompt }}" "${{ inputs.growth_mode }}"
